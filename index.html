<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WSP-SSP LOGIN</title>
    <link rel="stylesheet" href="login.css">       

  
</head>
<body>
    <img src= "https://miniawater.com/public/img/uy.jpg" class="image1">
    <img src= "https://miniawater.com/public/img/uy.jpg" class="image2">
    <h1 class="heads">شركة المنيا لمياه الشرب والصرف الصحى</h1>
    <h2 class="heads">قطاع المعامل والجودة وشئون البيئة</h2>
    <h3 class="heads">الإدارة العامة لمأمونية المياه وتداول الصرف الصحى</h3>

    <form id="loginForm">
        <label for="login-email"><b>Email</b></label>
        <input required id="login-email" type="email" placeholder="Enter your mail">

        <label for="login-department"><b>Section</b></label>
        <select required id="login-department">
            <option value="">Choose your section</option>
            <option value="العدوه">العدوه</option>
            <option value="مغاغة">مغاغة</option>
            <option value="بنى مزار">بنى مزار</option>
            <option value="مطاى">مطاى</option>
            <option value="سمالوط">سمالوط</option>
            <option value="المنيا">المنيا</option>
            <option value="ابوقرقاص">ابوقرقاص</option>
            <option value="ملوى">ملوى</option>
            <option value="ديرمواس">ديرمواس</option>
            <option value="WSP">WSP</option>
        </select>

        <button type="submit">LOG IN</button>
        <div id="login-message" datastatus="Connection error"></div>
    </form>

    <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbwm-xoojxIaAJ8-cLLIRFAthMHT1FFWS8w0gHtf6xlhU5xP3eqB47CQucqea4GDEm0Zlw/exec";

        document.getElementById("loginForm").addEventListener("submit", e => {
        e.preventDefault();

    const email = document.getElementById("login-email").value.trim();
    const department = document.getElementById("login-department").value;

    const url = `${scriptURL}?action=login&email=${encodeURIComponent(email)}&department=${encodeURIComponent(department)}`;

    fetch(url, {
      method: "GET",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8"
      },
    })
    .then(response => {
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      return response.json();
    })
    .then(data => {
      if (data.status.toLowerCase() === "authorized") {
        sessionStorage.setItem("email", data.email);
        sessionStorage.setItem("department", data.department);
        document.getElementById("login-message").textContent = "Authorized";
        document.getElementById("login-email").value = "";
        document.getElementById("login-department").value = "";
        document.getElementById("login-message").textContent = "";
        window.location = "waterqualitymonitoring.html";
      } else {
        document.getElementById("login-message").textContent = "Unauthorized";
      }
    })
    .catch(err => {
      console.error("خطأ:", err);
      document.getElementById("login-message").textContent = "Connection Error";
    });
  });     
      
    </script>

</body>












